import{j as e,B as u,a as B,b as v,g as i,q as N,P as C,i as H,I as O,_ as Q,W as _,X as $,$ as z,a0 as M,l as R,Y as W,n as Y,v as q,D as G,w as U,x as X,y as J,a1 as K,z as V,Q as Z,A as ee}from"./mui-CFDhWL5c.js";import{u as te,a as s,c as S}from"./vendor-zWPymlFl.js";import{M as D}from"./MainLayout-B2T8W_MF.js";import{c as I}from"./chatService-RISS4X7f.js";import"./index-DnHAAhUv.js";import"./supabase-DTcxSDRM.js";const le=()=>{const p=te(),[l,m]=s.useState([]),[c,d]=s.useState([]),[n,b]=s.useState(""),[w,g]=s.useState(!0),[A,y]=s.useState(!1),[h,j]=s.useState(null),[o,r]=s.useState({open:!1,message:"",severity:"success"});s.useEffect(()=>{k()},[]),s.useEffect(()=>{if(n.trim()==="")d(l);else{const t=l.filter(a=>a.title.toLowerCase().includes(n.toLowerCase()));d(t)}},[n,l]);const k=async()=>{try{g(!0);const t=await I.getChatSessions();m(t),d(t)}catch(t){console.error("Error fetching chat sessions:",t),r({open:!0,message:"Failed to load chat history",severity:"error"})}finally{g(!1)}},L=(t,a)=>{t.stopPropagation(),j(a),y(!0)},x=()=>{y(!1),j(null)},T=async()=>{if(h)try{await I.deleteChatSession(h),m(t=>t.filter(a=>a.id!==h)),r({open:!0,message:"Conversation deleted successfully",severity:"success"})}catch(t){console.error("Error deleting chat session:",t),r({open:!0,message:"Failed to delete conversation",severity:"error"})}finally{x()}},E=t=>{p(`/chat/${t}`)},f=()=>{p("/chat")},F=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});return w?e.jsx(D,{children:e.jsx(u,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(B,{})})}):e.jsx(D,{children:e.jsxs(u,{sx:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(v,{variant:"h4",component:"h1",children:"Conversation History"}),e.jsx(i,{variant:"contained",color:"primary",startIcon:e.jsx(N,{}),onClick:f,children:"New Conversation"})]}),e.jsx(C,{sx:{mb:3,p:1},children:e.jsx(H,{fullWidth:!0,placeholder:"Search conversations...",value:n,onChange:t=>b(t.target.value),InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Q,{})})},size:"small"})}),c.length===0?e.jsxs(C,{sx:{p:3,textAlign:"center"},children:[e.jsx(v,{variant:"body1",color:"textSecondary",children:n.trim()!==""?"No conversations match your search.":"You haven't started any conversations yet."}),n.trim()===""&&e.jsx(i,{variant:"contained",color:"primary",sx:{mt:2},onClick:f,children:"Start a Conversation"})]}):e.jsx(_,{sx:{bgcolor:"background.paper",flexGrow:1,overflow:"auto"},children:c.map((t,a)=>e.jsxs(S.Fragment,{children:[e.jsxs($,{alignItems:"flex-start",button:!0,onClick:()=>E(t.id),secondaryAction:e.jsx(Y,{edge:"end","aria-label":"delete",onClick:P=>L(P,t.id),children:e.jsx(q,{})}),children:[e.jsx(z,{children:e.jsx(M,{sx:{bgcolor:"secondary.main"},children:e.jsx(R,{})})}),e.jsx(W,{primary:t.title,secondary:e.jsx(S.Fragment,{children:`Last updated ${F(t.updated_at||t.created_at)}`})})]}),a<c.length-1&&e.jsx(G,{variant:"inset",component:"li"})]},t.id))}),e.jsxs(U,{open:A,onClose:x,children:[e.jsx(X,{children:"Delete Conversation"}),e.jsx(J,{children:e.jsx(K,{children:"Are you sure you want to delete this conversation? This action cannot be undone."})}),e.jsxs(V,{children:[e.jsx(i,{onClick:x,children:"Cancel"}),e.jsx(i,{onClick:T,color:"error",children:"Delete"})]})]}),e.jsx(Z,{open:o.open,autoHideDuration:6e3,onClose:()=>r({...o,open:!1}),children:e.jsx(ee,{onClose:()=>r({...o,open:!1}),severity:o.severity,sx:{width:"100%"},children:o.message})})]})})};export{le as default};
//# sourceMappingURL=ChatHistory-BVi8tZIQ.js.map
